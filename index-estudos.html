<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <title>Lista de Posts</title>
</head>

<body>
  <!-- Título principal da página -->
  <h1>Posts</h1>

  <!-- Lista onde os posts vão ser exibidos -->
  <ul id="lista-posts"></ul>

  <!-- Seção para criar um novo post -->
  <h2>Novo Post</h2>
  <input type="text" id="titulo" placeholder="Título do post">
  <button onclick="criarPost()">Adicionar</button>

  <script>
    // URL base da API (neste caso, provavelmente JSON-Server rodando em localhost:3000)
    const API_URL = 'http://localhost:3000/posts';

    // Função responsável por buscar e exibir os posts
    function carregarPosts() {
      // Faz uma requisição GET para a API
      fetch(API_URL)
        // Converte a resposta para JSON
        .then(res => res.json())
        // Quando os dados estiverem prontos (resolvidos), executa esta função
        .then(posts => {
          // Seleciona a lista UL do HTML onde os posts serão exibidos
          const lista = document.getElementById('lista-posts');

          // Limpa a lista antes de recarregar os itens
          lista.innerHTML = '';

          // Percorre cada post retornado pela API
          posts.forEach(post => {
            // Cria um elemento de lista (<li>) para exibir o post
            const li = document.createElement('li');

            // Adiciona o título do post no elemento de lista
            li.textContent = post.title + ' ';

            // Cria um botão de exclusão para cada post
            const btnExcluir = document.createElement('button');
            btnExcluir.textContent = 'Excluir';

            // Quando o botão for clicado, faz uma requisição DELETE para remover o post
            btnExcluir.onclick = () => {
              fetch(`${API_URL}/${post.id}`, { method: 'DELETE' })
                // Após excluir, recarrega a lista de posts
                .then(() => carregarPosts())
                // Caso dê erro na exclusão, mostra no console
                .catch(err => console.error('Erro ao excluir post:', err));
            };

            // Adiciona o botão de excluir dentro do <li>
            li.appendChild(btnExcluir);

            // Adiciona o <li> completo dentro da lista <ul>
            lista.appendChild(li);
          });
        })
        // Caso dê erro na requisição inicial, mostra no console
        .catch(err => console.error('Erro ao carregar posts:', err));
    }

    // Função para criar um novo post
    function criarPost() {
      // Pega o valor digitado no input e remove espaços extras
      const titulo = document.getElementById('titulo').value.trim();

      // Se o campo estiver vazio, alerta o usuário e não envia nada
      if (!titulo) {
        alert('Digite um título antes de enviar!');
        return;
      }

      // Envia uma requisição POST para a API criando um novo post
      fetch(API_URL, {
        method: 'POST', // Método HTTP usado para criar
        headers: {
          'Content-Type': 'application/json' // Indica que o corpo da requisição é JSON
        },
        body: JSON.stringify({ // Converte o objeto JS em JSON
          title: titulo, // Usa o valor digitado no input
          body: 'Post criado via fetch', // Corpo fictício do post
          userId: 1 // Usuário fictício
        })
      })
        // Converte a resposta da API em JSON
        .then(res => res.json())
        // Quando o post for criado, executa esta função
        .then(data => {
          console.log('Post criado:', data); // Mostra no console o objeto retornado da API

          // Limpa o campo de texto depois de criar o post
          document.getElementById('titulo').value = '';

          // Atualiza a lista de posts para incluir o novo
          carregarPosts();
        })
        // Caso dê erro na criação, mostra no console
        .catch(err => console.error('Erro ao criar post:', err));
    }

    // Chama a função assim que a página carregar, exibindo os posts existentes
    carregarPosts();

  </script>

  <script>
    // reescrevendo a função carregarPosts() com async/await
    async function carregarPosts() {
      try {
        const res = await fetch(API_URL);
        const posts = await res.json();

        const lista = document.getElementById('lista-posts');
        lista.innerHTML = '';

        posts.forEach(post => {
          const li = document.createElement('li');
          li.textContent = post.title + ' ';

          // Botão Excluir
          const btnExcluir = document.createElement('button');
          btnExcluir.textContent = 'Excluir';
          btnExcluir.onclick = async () => {
            try {
              await fetch(`${API_URL}/${post.id}`, { method: 'DELETE' });
              await carregarPosts();
            } catch (err) {
              console.error('Erro ao excluir post:', err);
            }
          };

          // Botão Editar
          const btnEditar = document.createElement('button');
          btnEditar.textContent = 'Editar';
          btnEditar.onclick = async () => {
            const novoTitulo = prompt('Editar título do post:', post.title);
            if (novoTitulo) {
              try {
                await fetch(`${API_URL}/${post.id}`, {
                  method: 'PUT',
                  headers: {
                    'Content-Type': 'application/json'
                  },
                  body: JSON.stringify({
                    title: novoTitulo,
                    body: post.body,
                    userId: post.userId
                  })
                });
                await carregarPosts();
              } catch (err) {
                console.error('Erro ao editar post:', err);
              }
            }
          };

          li.appendChild(btnExcluir);
          li.appendChild(btnEditar);
          lista.appendChild(li);
        });

      } catch (err) {
        console.error('Erro ao carregar posts:', err);
      }
    }

  </script>

  <script>
    // função carregar posts resumida
    // Usar async / await → elimina vários.then() aninhados.
    // Extrair a criação dos botões em uma função auxiliar → deixa o código mais limpo.
    // Usar desestruturação({ id, title, body, userId }) em vez de post.id, post.title, etc.

    async function carregarPosts() {
      try {
        const res = await fetch(API_URL);
        const posts = await res.json();

        const lista = document.getElementById('lista-posts');
        lista.innerHTML = '';

        posts.forEach(({ id, title, body, userId }) => {
          const li = document.createElement('li');
          li.textContent = title + ' ';

          // Botão Excluir
          const btnExcluir = criarBotao('Excluir', async () => {
            try {
              await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
              carregarPosts();
            } catch (err) {
              console.error('Erro ao excluir post:', err);
            }
          });

          // Botão Editar
          const btnEditar = criarBotao('Editar', async () => {
            const novoTitulo = prompt('Editar título do post:', title);
            if (novoTitulo) {
              try {
                await fetch(`${API_URL}/${id}`, {
                  method: 'PUT',
                  headers: { 'Content-Type': 'application/json' },
                  body: JSON.stringify({ title: novoTitulo, body, userId })
                });
                carregarPosts();
              } catch (err) {
                console.error('Erro ao editar post:', err);
              }
            }
          });

          li.append(btnExcluir, btnEditar);
          lista.appendChild(li);
        });

      } catch (err) {
        console.error('Erro ao carregar posts:', err);
      }
    }

    // Função auxiliar para criar botões
    function criarBotao(texto, onClick) {
      const btn = document.createElement('button');
      btn.textContent = texto;
      btn.onclick = onClick;
      return btn;
    }
  </script>
  
</body>


</html>