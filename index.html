<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Lista de Posts</title>
</head>
<body>
  <h1>Posts</h1>

  <!-- Lista onde vamos renderizar os posts vindos da API -->
  <ul id="lista-posts"></ul>

  <h2>Novo Post</h2>
  <!-- Campo de texto para digitar o título do post -->
  <input type="text" id="titulo" placeholder="Título do post">
  <!-- Botão que chama a função de criar post -->
  <button onclick="criarPost()">Adicionar</button>

  <script>
    // ===============================
    // CONFIGURAÇÃO DA API
    // ===============================
    // Aqui definimos a URL da API do json-server
    // Evitamos usar o nome "URL" para não conflitar com a função nativa do JS
    const API_URL = 'http://localhost:3000/posts';

    // ===============================
    // FUNÇÃO PARA CARREGAR POSTS (GET)
    // ===============================
    function carregarPosts() {
      fetch(API_URL) // Faz uma requisição GET (buscar informações) para a API 
      // ou faz uma requisição HTTP GET para a URL armazenada em API_URL
      // fetch retorna uma Promise que resolve para um objeto Response do navegador 
      // Promise - é um "pacote" que representa um valor que ainda não chegou, 
      // mas que vai chegar no futuro (como um pedido no delivery: você faz o pedido e espera).
      // "resolve" → quando a operação assíncrona termina com sucesso, a Promise é "resolvida" e entrega o resultado para o próximo .then(...).
      // Objeto Response → é a “resposta bruta” que o servidor enviou, contendo:
      // O status (200, 404, 500 etc.); Os headers (informações extras como tipo de conteúdo);
      // O corpo da resposta (body), que ainda precisa ser convertido para texto ou JSON.
        .then(res => res.json()) // Converte a resposta para JSON
        .then(posts => { // .then(...) → recebe o resultado da Promise anterior.
        // posts → é o nome do parâmetro que você escolheu para representar esse resultado.
        // No caso acima, como .then(res => res.json()) retorna os dados JSON já
        // convertidos para objeto/array JavaScript, o posts vai conter esses dados.
          const lista = document.getElementById('lista-posts'); // Essa linha pega o elemento HTML com id="lista-posts" e guarda na variável lista,
          // para que você possa trabalhar com ele no JavaScript
          lista.innerHTML = ''; // Limpa a lista antes de adicionar novos itens
          posts.forEach(post => { // Para cada elemento dentro do array posts, execute o bloco de código a seguir
            // usando o nome post para se referir a esse elemento.
            const li = document.createElement('li'); // cria um elemento html via js que possui a tag <li> ,ou seja, um elemento de uma lista e armazena na variável "li"
            li.textContent = post.title; // Mostra apenas o título
            lista.appendChild(li);
          });
        })
        .catch(err => console.error('Erro ao carregar posts:', err));
    }

    // ===============================
    // FUNÇÃO PARA CRIAR POST (POST)
    // ===============================
    function criarPost() {
      const titulo = document.getElementById('titulo').value.trim();

      // Validação simples: se o título estiver vazio, não envia
      if (!titulo) {
        alert('Digite um título antes de enviar!');
        return;
      }

      // Faz uma requisição POST para a API
      fetch(API_URL, {
        method: 'POST', // Método HTTP
        headers: {
          'Content-Type': 'application/json' // Tipo de conteúdo que estamos enviando
        },
        body: JSON.stringify({
          title: titulo,            // Campo título
          body: 'Post criado via fetch', // Conteúdo fixo (pode ser alterado)
          userId: 1                 // Apenas um exemplo de campo extra
        })
      })
      .then(res => res.json()) // Converte a resposta para JSON
      .then(data => {
        console.log('Post criado:', data);
        document.getElementById('titulo').value = ''; // Limpa o campo
        carregarPosts(); // Recarrega a lista para incluir o novo post
      })
      .catch(err => console.error('Erro ao criar post:', err));
    }

    // ===============================
    // CARREGAR POSTS AUTOMATICAMENTE
    // ===============================
    // Quando a página for carregada, já exibe os posts
    carregarPosts();
    
  </script>
</body>
</html>
